# Laboratoire 16Â½

Ce laboratoire couvre les notions des cours 16 et 17.

<center>![Stime](../../static/img/labo16/stime.png)</center>

TÃ©lÃ©chargez les [projets de dÃ©part](../../static/files/labo16.zip). N'oubliez pas de mettre Ã  jour la base de donnÃ©es avec `dotnet ef database update`.

**Ce labo peut sembler intimidant**, mais au final c'est principalement (presque) copier-coller 5 actions Ã  partir des exemples dans la section Access Control du cours 17.

## ğŸ” Qui Ãªtes-vous ?

La gestion des utilisateurs (inscription et connexion) est dÃ©jÃ  largement implÃ©mentÃ©e **cÃ´tÃ© serveur**. Il restera juste Ã  complÃ©ter l'implÃ©mentation **cÃ´tÃ© client**.

Vous aurez Ã  faire toute l'implÃ©mentation **cÃ´tÃ© serveur** en faisant le **TP3** trÃ¨s bientÃ´t et ce sera dÃ©jÃ  assez.

<center>![Inscription et connexion](../../static/img/labo16/user.png)</center>

### 1 - Inscription

[ğŸ’¡](/cours/rencontre8.2#-inscription) ComplÃ©tez le code **cÃ´tÃ© Angular** pour que l'inscription soit fonctionnelle.

Testez si cela fonctionne en crÃ©ant un utilisateur.

### 2 - Connexion

[ğŸ’¡](/cours/rencontre8.2#-connexion) ComplÃ©tez le code **cÃ´tÃ© Angular** pour que la connexion soit fonctionnelle.

Testez si cela fonctionne en vous connectant.

## ğŸ’¼ Et que voulez-vous ?

Dans cette section, vous aurez Ã  complÃ©ter toutes les actions de `ReviewsController`. Pas besoin d'utiliser un **service** (Ã€ part **UserManager**) dans ce laboratoire. Codez tout directement dans les actions du contrÃ´leur.

<center>![Critiques](../../static/img/labo16/review1.png)</center>

### 3 - PostReview

[ğŸ’¡](/cours/rencontre9.1#-post) ComplÃ©tez l'action `Post`Â qui permettra d'ajouter un `Review` dans la base de donnÃ©es.

[ğŸ’¡](/cours/rencontre8.2#-action-rÃ©servÃ©e-aux-utilisateurs) Cette action devra seulement Ãªtre utilisable par les utilisateurs authentifiÃ©s.

[ğŸ’¡](/cours/rencontre8.2#-exemple-de-requÃªte-utilisant-le-token) Assurez-vous de joindre le token Ã  la requÃªte puisqu'elle nÃ©cessitera l'authentification.

[ğŸ’¡](/cours/rencontre8.1#-data-transfer-objects) Il faudra un DTO pour envoyer le **nom du jeu** et le **texte de la critique**.

[ğŸ’¡](/cours/rencontre8.2#%EF%B8%8F%EF%B8%8F-dÃ©terminer-qui-envoie-la-requÃªte) Il faudra vÃ©rifier qui envoie la requÃªte pour l'associer Ã  la nouvelle `Review`.

[ğŸ’¡](/cours/rencontre9.1#-data-transfer-objects) Il faudra retourner, avec `Ok(...)`, un objet un peu diffÃ©rent du modÃ¨le `Review`. VÃ©rifiez le modÃ¨le `Review` cÃ´tÃ© Angular pour crÃ©er et utiliser le parfait **DTO** !

### 4 - GetReview

:::note

Gardez Ã  l'esprit que cette requÃªte est dÃ©jÃ  automatiquement appelÃ©e lorsque la page Web est rÃ©actualisÃ©e.

:::

[ğŸ’¡](/cours/rencontre9.1#-data-transfer-objects) Il faudra simplement retourner la liste de tous les `Review` convertis avec le mÃªme **DTO** que crÃ©Ã© plus haut pour `Post`.

[ğŸ’¡](/cours/rencontre8.2#-action-rÃ©servÃ©e-aux-utilisateurs) Cette action doit Ãªtre disponible pour tous, mÃªme si nous ne sommes pas authentifiÃ©s.

### 5 - DeleteReview

[ğŸ’¡](/cours/rencontre9.1#-delete) Seul l'auteur d'une critique doit Ãªtre capable de la supprimer.

### 6 - EditReview

<center>![Modifier une critique](../../static/img/labo16/review2.png)</center>

[ğŸ’¡](/cours/rencontre9.1#-put) Seul l'auteur d'une critique doit Ãªtre capable de la modifier.

[ğŸ’¡](/cours/rencontre9.1#-put) Seul le texte de la critique doit pouvoir Ãªtre modifiÃ©. (Utilisez le mÃªme **DTO** que pour `Post` et ignorez le nom du jeu, par exemple !)

### 7 - UpvoteReview

[ğŸ’¡](/cours/rencontre9.1#-put) Seul un utilisateur authentifiÃ© **qui N'est PAS** l'auteur d'une critique doit Ãªtre capable de la _posivoter_.

Notez que si on _posivote_ une critique qu'on a **dÃ©jÃ  _posivitÃ©_**, Ã§a doit annuler / retirer notre upvote.

## ğŸ”‘ QualitÃ© > QuantitÃ©

### 8 - Interceptor

[ğŸ’¡](/cours/rencontre8.2#-intercepteurs) Normalement, vous avez joint un token pour plusieurs requÃªtes dans le **projet Angular**. Remplacez ce code rÃ©pÃ©titif par un **intercepteur**.